// npx prisma migrate reset
//npx prisma migrate dev --name init
//npx prisma db push
//npx prisma db seed

generator client {
  provider     = "prisma-client"
  output   = "generated"
  // output       = "generated/prisma"
  // moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  USER
  LANDLORD
  ADMIN
}

enum PropertyType {
  ROOM
  APARTMENT
  HOUSE
  CONDO
}

model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  password  String
  img_url   String?
  role      UserRole @default(USER)

  properties  Property[]
  favorites Favorite[]
  phone Phone[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

model Phone {
  id    Int   @id @default(autoincrement())
  phoneNumber   String

  userId       String       @map("user_id")
  user         User         @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Location {
  id        Int     @id @default(autoincrement())
  city      String
  district  String
  map_url   String?

  properties  Property[]

  @@map("locations")
}

model Property {
  id           String        @id @default(uuid())
  userId       String        @map("user_id")
  locationId   Int           @map("location_id")

  title        String
  description  String?

  price        Float
  deposit      Float?

  propertyType PropertyType @default(ROOM)
  sizeSqm      Int?
  furnished    Boolean      @default(false)

  coverKey     String?
  isPublished  Boolean      @default(true)

  user         User         @relation(fields: [userId], references: [id])
  location     Location     @relation(fields: [locationId], references: [id])

  images       PropertyImage[]
  favorites    Favorite[]
  propertyViews    PropertyViews[]
  propertyAmenities    PropertyAmenity[]

  createdAt    DateTime     @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId, locationId, propertyType])

  @@map("properties")

}

model PropertyViews {
  id          String    @id @default(uuid())

  property_id String    @map("property_id")
  property    Property  @relation(fields: [property_id], references: [id], onDelete: Cascade)

  createdAt    DateTime @default(now())

  @@index([property_id])

  @@map("property_views")

}

model PropertyImage {
  id         String   @id @default(uuid())
  propertyId String   @map("property_id")
  imageKey   String   // image path in R2
  isCover    Boolean  @default(false)

  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  createdAt  DateTime @default(now())

  @@index([propertyId])

  @@map("property_images")

}

model Amenity {
  id        Int     @id @default(autoincrement())
  name      String  @unique   // Wifi, Parking, Aircon
  icon      String?           // icon name (lucide, etc.)
  category  String?           // BASIC, SECURITY, COMFORT

  properties PropertyAmenity[]

  @@map("amenities")
}

model PropertyAmenity {
  propertyId String
  amenityId  Int      @map("amenity_id")

  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  amenity    Amenity  @relation(fields: [amenityId], references: [id], onDelete: Cascade)

  @@id([propertyId, amenityId]) // composite PK

  @@map("property_amenities")
}


model Favorite {
  id         String   @id @default(uuid())
  userId     String
  propertyId String   @map("property_id")

  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  createdAt  DateTime @default(now())

  @@unique([userId, propertyId])

  @@map("favourites")
}


