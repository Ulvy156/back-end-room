// npx prisma migrate reset
//npx prisma migrate dev --name init
//npx prisma db push
//npx prisma db seed

generator client {
  provider     = "prisma-client"
  output   = "generated"
  // output       = "generated/prisma"
  // moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  USER
  LANDLORD
  ADMIN
}

// enum PropertyType {
//   ROOM
//   APARTMENT
//   HOUSE
//   CONDO
// }

model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  password  String
  img_url   String?
  isLocked  Boolean  @default(false)
  role      UserRole @default(USER)
  district_id      Int @default(1211)

  properties  Property[]
  favorites Favorite[]
  phone Phone[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

model Phone {
  id    Int   @id @default(autoincrement())
  phoneNumber   String

  userId       String       @map("user_id")
  user         User         @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Province {
  id        Int     @id
  nameKh    String
  nameEn    String
  districts District[]

  @@map("provinces")
}
model District {
  id         Int      @id
  provinceId Int
  nameKh     String
  nameEn     String

  province   Province @relation(fields: [provinceId], references: [id])

  @@index([provinceId])

  @@map("districts")

}

model LocationView {
  id          Int      @id @default(autoincrement())
  provinceId  Int?
  districtId  Int?
  views       Int      @default(0)
  updatedAt   DateTime @updatedAt
}

model Property {
  id           String        @id @default(uuid())
  userId       String        @map("user_id")
  location     String        
  location_url     String?     
  district_id      Int @default(1211)

  title        String
  description  String?

  price        Float
  deposit      Float?

  totalViews   Int?    @default(0) @map("total_views")

  propertyTypeId Int   @map("property_type_id")
  sizeSqm      Int
  furnished    Boolean      @default(false)

  isPublished  Boolean      @default(true)

  user         User         @relation(fields: [userId], references: [id])
  propertyType   PropertyType @relation(fields: [propertyTypeId], references: [id])

  images       PropertyImage[]
  favorites    Favorite[]
  propertyAmenities    PropertyAmenity[]

  createdAt    DateTime     @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId, propertyTypeId])

  @@map("properties")

}

model PropertyType {
  id        Int      @id     @default(autoincrement())
  code      String   @unique
  nameEn    String   @unique
  nameKh    String   @unique
  slug      String   @unique    // URL-safe name used for SEO + clean routes.
  isRemoved  Boolean  @default(false)

  properties Property[]

  createdAt DateTime @default(now())

  @@map("property_types")
}


// model PropertyViews {
//   id          String    @id @default(uuid())

//   totalViews   BigInt    @default(0) @map("total_views")

//   property_id String    @map("property_id")
//   property    Property  @relation(fields: [property_id], references: [id], onDelete: Cascade)

//   createdAt    DateTime @default(now())

//   @@index([property_id])

//   @@map("property_views")

// }

model PropertyImage {
  id         String   @id @default(uuid())
  propertyId String   @map("property_id")
  imageKey   String   // image path in R2

  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  createdAt  DateTime @default(now())

  @@index([propertyId])

  @@map("property_images")

}

model Amenity {
  id        Int     @id @default(autoincrement())
  code      String   @unique
  nameEn    String   @unique
  nameKh    String   @unique
  icon      String           // icon name (lucide, etc.)

  properties PropertyAmenity[]

  createdAt  DateTime @default(now())

  @@map("amenities")
}

model PropertyAmenity {
  propertyId String
  amenityId  Int      @map("amenity_id")

  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  amenity    Amenity  @relation(fields: [amenityId], references: [id], onDelete: Cascade)

  @@id([propertyId, amenityId]) // composite PK

  @@map("property_amenities")
}


model Favorite {
  id         String   @id @default(uuid())
  userId     String
  propertyId String   @map("property_id")

  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  createdAt  DateTime @default(now())

  @@unique([userId, propertyId])

  @@map("favourites")
}


